# IP의 한계와 포트

네트워크 계층의 핵심 프로토콜인 IP(Internet Protocol)는 **신뢰할 수 없는 통신**과 **비연결형 통신**이라는 두 가지 한계를 가지고 있습니다.  
이러한 한계를 보완하기 위해, 네트워크 계층과 응용 계층 사이에 위치한 **전송 계층(Transport Layer)** 이 존재합니다.  
전송 계층은 **TCP**와 **UDP**와 같은 전송 프로토콜을 통해 IP의 한계를 극복하고, **포트 번호(port number)** 를 이용해 응용 계층의 애플리케이션 프로세스를 정확하게 식별하는 역할을 합니다.

---

## 신뢰할 수 없는 통신과 비연결형 통신

### ✅ 신뢰할 수 없는 통신 (Unreliable Communication)

- IP는 데이터를 목적지까지 보낼 뿐, **정확히 도착했는지 확인하지 않습니다.**
- 다음과 같은 상황이 발생해도 IP는 별도의 처리를 하지 않습니다:
  - 패킷 손실
  - 패킷 중복
  - 순서 뒤바뀜
  - 데이터 손상
- 이를 **최선형 전달(Best-effort Delivery)** 이라고 부릅니다.  
  즉, 가능한 최선을 다해 전달하지만 그 결과는 보장하지 않습니다.

### ✅ 비연결형 통신 (Connectionless Communication)

- 통신을 위해 **사전 연결을 설정하지 않음**  
- 송신자가 수신자에게 단순히 패킷을 전송할 뿐, **세션을 유지하거나 상태를 관리하지 않음**
- 전화보다는 편지와 비슷한 개념

### ❓ 왜 이렇게 설계되었는가?

- 연결 수립과 상태 관리 없이 단순하게 동작하므로 **처리 속도가 빠르고 구현이 간단**
- 네트워크 자원을 아낄 수 있어 **라우터와 네트워크 장비의 부담이 줄어듦**
- IP는 모든 장비에서 기본적으로 작동해야 하므로, **범용성과 효율성이 중요**

---

## IP의 한계를 보완하는 전송 계층

전송 계층은 IP의 한계를 다음과 같은 방식으로 보완합니다.

### 1️⃣ 연결형 통신 (Connection-oriented Communication)

- 대표 프로토콜: **TCP (Transmission Control Protocol)**
- 데이터를 전송하기 전에 **3-way handshake** 를 통해 연결을 수립
- 연결된 상태를 유지하면서 **순서 보장**, **에러 복구**, **종료 처리** 가능
- 전화 통화처럼 **대화의 시작-진행-종료** 구조를 가짐

### 2️⃣ 신뢰성 있는 통신 (Reliable Communication)

- **패킷 손실이 발생하면 재전송**, 손상 여부를 검사하여 **정확한 데이터 전달** 보장
- 주요 기능:
  - **오류 제어 (Error Control)**: Checksum 사용
  - **흐름 제어 (Flow Control)**: 수신자의 처리 능력에 맞게 데이터 전송 속도 조절
  - **혼잡 제어 (Congestion Control)**: 네트워크 혼잡 상황 시 전송 속도 조절

### ⚡ 반면, **UDP(User Datagram Protocol)** 는:

- 연결 수립 없이 전송 가능
- 신뢰성 보장하지 않음 (패킷 손실/순서 뒤바뀜 가능)
- 빠른 전송이 중요할 때 사용
  - 예: **동영상 스트리밍, 실시간 게임, VoIP(인터넷 전화)**

---

## 응용 계층과의 연결 다리, 포트

### 🔍 포트란?

- 하나의 호스트(컴퓨터)에서 여러 애플리케이션이 네트워크를 사용할 수 있도록 **각 애플리케이션에 번호를 부여**
- 이 번호를 **포트 번호(port number)** 라고 함
- IP 주소만으로는 **호스트는 식별할 수 있지만, 그 안의 특정 애플리케이션은 식별할 수 없음**
- 포트 번호를 이용해, **IP 주소 + 포트 번호** 조합으로 애플리케이션 프로세스를 지정

### 📊 포트 번호의 분류

| 포트 종류            | 포트 범위        | 설명                                                         | 예시                       |
|---------------------|------------------|--------------------------------------------------------------|----------------------------|
| Well-known port     | 0 ~ 1023         | OS나 시스템에서 사용하는 기본 서비스 포트 (표준화됨)         | HTTP(80), HTTPS(443), FTP(21), SSH(22) |
| Registered port     | 1024 ~ 49151     | 등록된 소프트웨어나 특정 서비스에서 사용하는 포트           | MySQL(3306), Oracle DB(1521) |
| Dynamic/Private/Ephemeral port | 49152 ~ 65535 | 클라이언트 애플리케이션이 일시적으로 사용하는 임시 포트       | 웹 브라우저가 자동 할당받는 포트 |

📌 예시:  
- 웹 서버가 80번 포트를 사용하면, 웹 브라우저는 해당 서버의 **IP 주소:80** 으로 요청을 보냄  
- 클라이언트는 **IP:49168** 같이 임시 포트를 통해 응답을 기다림

---

## 포트 기반 NAT

### 🌐 NAT란?

- **Network Address Translation**  
- 사설 네트워크(내부 IP)와 공인 네트워크(외부 IP) 간의 IP 주소 변환 기술
- 대부분의 가정이나 회사에서는 하나의 공인 IP만 갖고 여러 기기를 사용해야 하므로 NAT가 필요

### 🔀 NAPT (Network Address Port Translation)

- **포트 번호를 기준으로 사설 IP들을 구분하는 고급 NAT 방식**
- 하나의 공인 IP에 대해 **여러 사설 IP가 서로 다른 포트 번호로 식별되어 동시에 인터넷 사용 가능**
- 내부 ↔ 외부 통신을 매핑하기 위한 **NAT 테이블** 유지

### 📋 NAT 테이블 예시

| 내부 IP     | 내부 포트 | 공인 IP     | 공인 포트 |
|-------------|-----------|-------------|-----------|
| 192.168.0.2 | 34567     | 203.0.113.1 | 10001     |
| 192.168.0.3 | 45678     | 203.0.113.1 | 10002     |

- 외부에서 볼 땐 모두 `203.0.113.1`로 보이지만, 포트 번호로 누구에게 보낼지 구분 가능
- 외부 요청 도착 시, **공인 포트 번호를 기준으로 내부 IP와 포트를 찾아서 전달**

📌 **N:1 구조**를 통해 공인 IP 주소 부족 문제를 해결함

---

## ✅ 요약

| 항목              | 설명 |
|-------------------|------|
| **IP의 한계**       | 비연결형, 신뢰성 없음 (순서·재전송·에러 처리 없음) |
| **전송 계층의 역할** | TCP를 통해 신뢰성과 연결성 제공, UDP는 빠른 전송 지원 |
| **포트의 역할**     | 응용 계층 프로세스를 식별하는 데 사용 |
| **NAPT의 역할**     | 여러 사설 IP가 하나의 공인 IP를 공유 가능하게 함 (포트로 구분) |

