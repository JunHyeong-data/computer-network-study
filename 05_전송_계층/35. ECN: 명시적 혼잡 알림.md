# ECN: 명시적 혼잡 알림 (Explicit Congestion Notification)

---

## 개요

최근에는 TCP 혼잡 제어를 좀 더 **빠르고 효율적으로** 수행하기 위해 네트워크의 **중간 장치(주로 라우터)**의 도움을 받는 방식이 도입되었습니다. 이를 **명시적 혼잡 알림**, 줄여서 **ECN (Explicit Congestion Notification)**이라 부릅니다.

> ECN은 선택적 기능이므로, 이를 **지원하는 호스트**와 **지원하지 않는 호스트**가 존재합니다.

![ECN 지원 호스트 예시](https://github.com/user-attachments/assets/e00f1502-8e1b-4b45-8747-1ee1c757d465)

---

## ECN의 동작 방식

ECN을 통한 혼잡 회피는 라우터를 중심으로 이루어지며, 네트워크의 혼잡을 **문제가 생기기 전에 알림**으로써 더 빠르게 혼잡을 제어할 수 있게 합니다.

### 예시: 호스트 A → 라우터 → 호스트 B

![ECN 동작 예시](https://github.com/user-attachments/assets/65cb4445-f6ba-4dc5-b589-1e28d371aaad)

### ECN 흐름 단계별 설명

1. **송신 (Host A → Router)**  
   호스트 A가 호스트 B로 메시지를 보내기 위해 라우터를 거칩니다.

2. **혼잡 예측 (Router)**  
   라우터가 네트워크 혼잡을 예측하면 IP 헤더의 **ECN 비트**를 설정한 후, 패킷을 수신 측 호스트 B로 전달합니다.  
   - 예: IPv4 헤더의 ECN 비트가 `11` → 혼잡 감지 표시

3. **수신자 표시 (Host B → Host A)**  
   호스트 B는 전달받은 패킷 내에 ECN이 설정되어 있으면, TCP ACK 세그먼트의 **ECE (ECN Echo) 비트**를 설정하여 송신자에게 혼잡 상태를 알려줍니다.

4. **송신자 반응 (Host A)**  
   호스트 A는 수신한 ACK에서 ECE 비트를 확인하면, TCP 세그먼트에 **CWR (Congestion Window Reduced) 비트**를 설정하고, 혼잡 윈도우를 **절반으로 줄입니다.**

---

## ECN의 장점

- 기존 방식: **타임아웃** 또는 **3번의 중복 ACK** 수신 후 혼잡 제어 시작
- ECN 방식: **수신자 ACK의 ECE 비트**를 통해 더 빠르게 혼잡을 감지하고 대응

> ECN은 문제가 **발생하기 전에** 혼잡을 제어할 수 있으므로, **타이머 기반 재전송**보다 효율적입니다.

---

## 관련 필드

| 필드명 | 위치        | 설명                          |
|--------|-------------|-------------------------------|
| ECN    | IP 헤더     | 혼잡 상태 여부 표시           |
| ECE    | TCP 헤더    | ECN을 수신자에서 송신자에게 알림 |
| CWR    | TCP 헤더    | 송신자가 혼잡 제어 수행 완료 표시 |

---

## 참고

- **ECN 활성화**는 양쪽 호스트와 네트워크 장비가 모두 지원해야 효과적으로 동작합니다.
- ECN은 **QoS (Quality of Service)**와 함께 성능 최적화에 기여합니다.
