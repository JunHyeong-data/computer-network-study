# 안정성을 위한 기술

이번 절의 주제는 **안정성**입니다.  
먼저 안정성을 수치로 표현하는 **가용성**이라는 개념을 학습하고, 안정성을 높이기 위한 방법으로 **이중화**, **다중화**, **로드 밸런싱** 등에 대해 알아보겠습니다.

---

## 📈 가용성 (Availability)

- **안정성**이란 특정 기능을 언제든지 균일한 성능으로 수행할 수 있는 특성입니다.
  - 예: 안정적인 웹 서버 → 항상 응답 가능한 서버
  - 예: 안정적인 라우터 → 항상 라우팅 기능 제공

- **가용성(Availability)**: 컴퓨터 시스템이 특정 기능을 수행할 수 있는 **시간의 비율**

### 🧮 가용성 수식

> 가용성 = 업타임 / (업타임 + 다운타임)

| 가용성 | 1년간 다운타임 | 한 달간 다운타임 | 한 주간 다운타임 |
|--------|----------------|------------------|------------------|
| 90%    | 36.53일        | 73.05시간        | 16.8시간         |
| 99.95% | 4.38시간       | 21.92분          | 5.04분           |
| 99.999%| 5.26분         | 26.3초           | 6.05초           |
| 99.99999% | 3.16초      | 0.262초          | 0.0604초         |

- 다운타임을 낮추는 것이 가용성 향상의 핵심
- 문제 발생 시에도 정상적으로 기능할 수 있는 능력을 **결함 감내(Fault Tolerance)**라고 함

---

## 🧯 이중화 (Redundancy)

- **이중화(Redundancy)**: 무언가를 **이중으로 두는 기술**
  - 예비 시스템을 마련함으로써 장애 발생 시 대응 가능

### 📌 이중화 가능한 대상
- **물리 장비**: 서버, NIC, 스위치 등  
- **소프트웨어**: 웹 서버, 데이터베이스 등  
- 이들은 대부분 **SPOF (Single Point of Failure)** 임  
  → 하나의 고장이 전체 시스템 장애로 이어지는 지점

### 🖼️ SPOF 예시

> 라우터가 SPOF인 경우, 고장 시 전체 서비스 중단  
> ![SPOF 예시](https://github.com/user-attachments/assets/f27b9e19-845c-4632-ba9b-31ba0ff50ce2)

---

## 🧰 이중화 구성 방식

### 🔁 액티브/스탠바이 (Active/Standby)

- **한 시스템**은 가동 상태(Active),  
  **다른 시스템**은 대기 상태(Standby)
- 장애 발생 시 Standby 시스템이 자동으로 전환

### 🔁 액티브/액티브 (Active/Active)

- **두 시스템 모두 가동**
- 부하 분산 가능, 성능 향상 기대

---

## 📊 다중화 (Multiplexing)

- 이중화보다 **확장된 개념**
- 무언가를 **3개 이상** 두는 구성
- 더 높은 안정성 확보 가능

> ![다중화 예시](https://github.com/user-attachments/assets/9b969a4b-8ab5-476c-8aab-dcdd4d2732b6)

---

## 🌐 네트워크 인터페이스 다중화

### 🛠️ 티밍(Teaming) & 본딩(Bonding)

- 여러 개의 NIC(네트워크 카드)를 하나처럼 구성하는 기술
- **Teaming**: 주로 Windows 환경  
- **Bonding**: 주로 Linux 환경

> 목적: 성능 향상 + 안정성 확보

---

## 🔄 로드 밸런싱 (Load Balancing)

고가용성을 요구하는 호스트는 보통 클라이언트가 아닌 **서버**입니다.  
서버를 **다중화**했다 하더라도 여전히 해결해야 할 문제가 있습니다.  
바로 **트래픽 분배**입니다.

트래픽은 서버의 **가용성**에 큰 영향을 미칩니다.

- **트래픽(traffic)**: 
  - 사전적 정의: 주어진 시점에 네트워크를 경유한 데이터의 양
  - 일반적 의미: 주어진 시점에 **특정 노드를 경유한 패킷의 양**

과도한 트래픽은 **서버의 가용성을 저하시킬 수 있습니다**.  
서버를 여러 개 두었다고 하더라도, **트래픽이 특정 서버에 몰리면** 그 서버의 가용성이 저하됩니다.

따라서 서버를 다중화했을 때에도 **트래픽을 고르게 분산**해야 **가용성 향상**이 가능합니다.

---

### ⚙️ 로드 밸런싱이란?

- **로드 밸런싱(load balancing)**:
  - `로드(Load)` = 부하
  - `밸런싱(Balancing)` = 균형 유지

즉, 여러 서버에 **부하를 균등하게 분산**하는 기술입니다.

- 수행 주체: **로드 밸런서**
  - 하드웨어: L4 스위치, L7 스위치 등
  - 소프트웨어: 로드 밸런싱 기능을 가진 프로그램도 가능

로드 밸런서는 일반적으로 다음처럼 **클라이언트와 서버 사이에 위치**하여, 클라이언트 요청을 서버로 **균등하게 분배**합니다.

> ![로드 밸런서 구성도](https://github.com/user-attachments/assets/50f2b486-5021-4888-bcc9-a0fcbc71f1ee)

---

### 🧠 로드 밸런싱 알고리즘

로드 밸런서는 여러 서버 중 **어떤 서버에 요청을 전달할지** 선택해야 합니다.  
이 선택 방식을 **로드 밸런싱 알고리즘**이라 부릅니다.

#### 대표적인 알고리즘

> ![로드 밸런싱 알고리즘 종류](https://github.com/user-attachments/assets/03888ebe-04f7-47cf-b4c8-331e2a7b37c4)

1. **라운드 로빈 (Round Robin)**  
   - 서버를 **순서대로** 돌며 요청을 분배

2. **최소 연결 (Least Connection)**  
   - 현재 **연결 수가 가장 적은 서버**부터 우선적으로 선택

3. **랜덤 (Random)**  
   - 서버를 **무작위**로 선택

4. **해시 기반 (Hash-Based)**  
   - 클라이언트 IP나 요청 URL 등을 기준으로 **해시값**을 구해 서버 선택

5. **응답 시간 기반 (Fastest Response)**  
   - 응답 시간이 가장 짧은 서버에 요청을 전달

---

### ⚖️ 가중치 기반 로드 밸런싱

- 서버마다 성능이 다를 경우, **가중치(weight)**를 부여하여 처리량을 조절할 수 있습니다.

#### 대표 알고리즘

- **가중치 라운드 로빈 (Weighted Round Robin)**
- **가중치 최소 연결 (Weighted Least Connection)**

> ![가중치 라운드 로빈 예시](https://github.com/user-attachments/assets/5cb2b62f-c29b-4053-a2c1-46b25251c3e8)

- 예시:
  - 서버 1: 가중치 5
  - 서버 2: 가중치 1
  - → 서버 1이 **5배 더 많은 요청**을 처리하도록 분배됨

이러한 가중치 기반 알고리즘은 **서버 간 성능이 다를 경우** 매우 유용하게 사용됩니다.

---
